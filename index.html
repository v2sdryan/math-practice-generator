<!doctype html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>因式分解 MC 練習器</title>
    <style>
      body { margin: 0; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC",sans-serif; background:#0b1020; color:#e5e7eb; }
      .wrap { max-width: 980px; margin: 24px auto; padding: 16px; }
      .card { background:#121933; border:1px solid #243050; border-radius:14px; padding:16px; margin-bottom:14px; }
      h1 { margin:0 0 8px; }
      .muted { color:#9ca3af; font-size:14px; }
      .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
      input, button { border-radius:10px; border:1px solid #334155; background:#0f172a; color:#e5e7eb; padding:10px; }
      input { width:120px; }
      button { cursor:pointer; border:none; background:#22c55e; color:#052e16; font-weight:700; }
      button.secondary { background:#334155; color:#e5e7eb; }
      .q { border:1px solid #334155; border-radius:12px; padding:12px; margin:10px 0; background:#0f172a; }
      .q h3 { margin:0 0 10px; font-size:17px; }
      .opt { display:block; margin:6px 0; }
      .result { margin-top:8px; padding:8px; border-radius:8px; font-size:14px; }
      .ok { background:#052e16; color:#86efac; }
      .bad { background:#3f1d1d; color:#fca5a5; }
      .hide { display:none; }
      .sticky { position: sticky; top: 0; z-index: 10; }
      .summary { font-weight:700; }
    </style>
  </head>
  <body>
    <main class="wrap">
      <section class="card sticky">
        <h1>同類題練習：平方差因式分解（MC）</h1>
        <p class="muted">題型固定為你提供的類型：<code>a² - (bm+cn)²</code>。可生成 1-100 題，多項選擇作答。交卷後，答錯題目會顯示計算方法。</p>
        <div class="row">
          <label>題數（1-100）：</label>
          <input id="count" type="number" min="1" max="100" value="10" />
          <button id="genBtn">生成題目</button>
          <button id="submitBtn" class="secondary">交卷批改</button>
          <button id="resetBtn" class="secondary">清除結果</button>
        </div>
        <p id="summary" class="summary"></p>
      </section>

      <section id="questions" class="card">
        <p class="muted">請先按「生成題目」。</p>
      </section>
    </main>

    <script>
      const $count = document.getElementById('count');
      const $genBtn = document.getElementById('genBtn');
      const $submitBtn = document.getElementById('submitBtn');
      const $resetBtn = document.getElementById('resetBtn');
      const $questions = document.getElementById('questions');
      const $summary = document.getElementById('summary');

      let quiz = [];

      function randint(a, b) { return Math.floor(Math.random() * (b - a + 1)) + a; }
      function shuffle(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      function buildQuestion(i) {
        const a = randint(4, 18);
        const b = randint(2, 9);
        const c = randint(2, 9);

        const expr = `${a*a} - (${b}m + ${c}n)^2`;
        const correct = `(${a} + ${b}m + ${c}n)(${a} - ${b}m - ${c}n)`;

        const wrong1 = `(${a} + ${b}m + ${c}n)(${a} - ${b}m + ${c}n)`;
        const wrong2 = `(${a} + ${b}m - ${c}n)(${a} - ${b}m - ${c}n)`;
        const wrong3 = `(${a} + ${b}m - ${c}n)(${a} - ${b}m + ${c}n)`;

        const optionsRaw = [
          { key: 'A', text: correct, ok: true },
          { key: 'B', text: wrong1, ok: false },
          { key: 'C', text: wrong2, ok: false },
          { key: 'D', text: wrong3, ok: false }
        ];

        const options = shuffle(optionsRaw).map((o, idx) => ({ ...o, label: 'ABCD'[idx] }));
        const answerLabel = options.find(o => o.ok).label;
        const method = `用平方差公式：x² - y² = (x+y)(x-y)。\n這題 x=${a}，y=(${b}m+${c}n)，\n所以 ${expr} = (${a}+${b}m+${c}n)(${a}-${b}m-${c}n)。`;

        return { id: i, expr, options, answerLabel, method };
      }

      function renderQuiz() {
        if (!quiz.length) {
          $questions.innerHTML = '<p class="muted">請先按「生成題目」。</p>';
          return;
        }
        $questions.innerHTML = quiz.map(q => `
          <div class="q" data-id="${q.id}">
            <h3>${q.id}. 因式分解：${q.expr}</h3>
            ${q.options.map(opt => `
              <label class="opt">
                <input type="radio" name="q-${q.id}" value="${opt.label}"> ${opt.label}. ${opt.text}
              </label>
            `).join('')}
            <div id="result-${q.id}" class="result hide"></div>
          </div>
        `).join('');
      }

      function generate() {
        let n = parseInt($count.value, 10);
        if (Number.isNaN(n) || n < 1) n = 1;
        if (n > 100) n = 100;
        $count.value = n;

        quiz = Array.from({ length: n }, (_, idx) => buildQuestion(idx + 1));
        $summary.textContent = `已生成 ${n} 題，請作答後按「交卷批改」。`;
        renderQuiz();
      }

      function grade() {
        if (!quiz.length) {
          alert('請先生成題目');
          return;
        }

        let answered = 0;
        let correct = 0;

        for (const q of quiz) {
          const checked = document.querySelector(`input[name="q-${q.id}"]:checked`);
          const box = document.getElementById(`result-${q.id}`);
          box.classList.remove('hide', 'ok', 'bad');

          if (!checked) {
            box.classList.add('bad');
            box.textContent = `未作答。正確答案：${q.answerLabel}`;
            continue;
          }

          answered++;
          if (checked.value === q.answerLabel) {
            correct++;
            box.classList.add('ok');
            box.textContent = `✅ 正確（答案：${q.answerLabel}）`;
          } else {
            box.classList.add('bad');
            box.textContent = `❌ 錯誤，你選 ${checked.value}；正確答案：${q.answerLabel}\n${q.method}`;
          }
        }

        const total = quiz.length;
        const wrong = total - correct;
        $summary.textContent = `完成批改：${correct}/${total} 正確（錯 ${wrong} 題；已作答 ${answered} 題）。`; 
      }

      function resetResult() {
        for (const q of quiz) {
          const checked = document.querySelector(`input[name="q-${q.id}"]:checked`);
          if (checked) checked.checked = false;
          const box = document.getElementById(`result-${q.id}`);
          if (box) {
            box.className = 'result hide';
            box.textContent = '';
          }
        }
        if (quiz.length) $summary.textContent = `已清除作答，可重新練習。`;
      }

      $genBtn.addEventListener('click', generate);
      $submitBtn.addEventListener('click', grade);
      $resetBtn.addEventListener('click', resetResult);
    </script>
  </body>
</html>
